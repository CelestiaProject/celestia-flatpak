app-id: space.celestia.celestia_gtk

runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk

command: celestia

finish-args:
  - --socket=x11
  - --device=dri
  - --filesystem=home

modules:
  - shared-modules/glu/glu-9.json
  - shared-modules/lua5.3/lua-5.3.5.json
  - shared-modules/gtk2/gtk2.json

  - name: gtkglext
    buildsystem: simple
    build-commands:
      - sed '/AC_PATH_XTRA/d' -i configure.in
      - autoreconf -vi
      - ./configure --prefix=/app
      - make
      - make install
    sources:
      - type: git
        url: https://gitlab.gnome.org/Archive/gtkglext
        tag: 1.2.0
        commit: 848578a45f2a35e498e7b8b5382645e380da92a9
      - type: patch
        path: kill-pangox.patch
        options: [-N]
      - type: patch
        path: gtk2.20.patch
        options: [-N]
      - type: patch
        path: gtkglext-gcc8.patch

  - name: celestia
    buildsystem: simple
    build-commands:
      - libtoolize
      - autoreconf -f
      - ./configure --with-gtk --prefix=/app
      - make
      - make install
    sources:
      - type: git
        url: https://github.com/CelestiaProject/Celestia
        tag: 1.6.3
        commit: e9a70d6a890a37c7f44a4a508f1ce626e188e104
